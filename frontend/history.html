<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assessment History - MaternaGuard</title>
<style>
body { font-family: 'Inter', sans-serif; background:#f9fafb; padding:20px; }
.container { max-width:800px; margin:50px auto; background:white; padding:40px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.1); }
h1 { color:#db486f; text-align:center; margin-bottom:30px; }
.history-item { border-bottom:1px solid #e5e7eb; padding:15px 0; }
.history-item:last-child { border-bottom:none; }
.history-item strong { color:#1f2937; }
</style>
</head>
<body>
<div class="container">
    <h1>My Assessment History</h1>
    <div id="historyContainer">Loading history...</div>
</div>

<script>
const baseUrl = window.location.origin;
const userId = localStorage.getItem('userId');

if (!userId) {
    alert('Please login first');
    window.location.href = 'login.html';
}

async function loadHistory() {
    const container = document.getElementById('historyContainer');
    try {
        const response = await fetch(`${baseUrl}/history/${userId}`);
        const data = await response.json();
        container.innerHTML = '';

        if (response.ok && data.history && data.history.length > 0) {
            data.history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <strong>Date:</strong> ${new Date(item.timestamp).toLocaleString()}<br>
                    <strong>Risk Score:</strong> ${item.risk_score}<br>
                    <strong>Top Factors:</strong> ${item.top_factors && item.top_factors.length > 0 ? item.top_factors.join(', ') : 'Overall health profile'}
                `;
                container.appendChild(div);
            });
        } else {
            container.innerHTML = "<p>No assessments yet.</p>";
        }
    } catch (error) {
        console.error(error);
        container.innerHTML = "<p>Error loading history. Please try again later.</p>";
    }
}

loadHistory();
</script>
</body>
</html>
